# ทำความเข้าใจกันก่อน

เนื่องจากว่าการสร้าง Linebot ด้วย LINE Messaging API นั้น ทางไลน์ได้บังคับมาว่าเว็บที่ใช้สำหรับเก็บโค้ดเพื่อทำการเชื่อมต่อกับ LINE API นั้นจะต้องเป็น https: เพราะฉะนั้นเลยกลายเป็นว่า หนังสือเล่มนี้ต้องเพิ่มเนื้อหาในส่วนของการใช้งาน Heroku เข้ามาด้วย เพราะผมเข้าใจว่าเราๆน่าจะยังไม่มีเว็บที่เป็น https เป็นของส่วนตัว เมื่ออยากจะทดสอบการเขียนโค้ดมันก็ต้องหาของฟรีมาลองดูก่อน ซึ่ง Heroku ตอบโจทย์สิ่งที่เราขาดทั้งหมด

## Heroku คืออะไร

Heroku เป็นคลาวเซอร์วิสตัวหนึ่งที่เป็นที่นิยมใช้งานมาก การจะสร้างโฮสต์ขึ้นมาเพื่อใช้สำหรับเก็บโค้ด คลิกๆ แค่ไม่กี่ครั้งก็ได้โฮสต์พร้อมใช้งาน อีกทั้ง Heroku ยังเชื่อมต่อกับ Github ได้ด้วย ทำให้เราไม่จำเป็นจะต้องใช้ FTP เพื่ออัปโหลดโค้ดขึ้นไปบนโฮสต์ เชื่อมต่อ Github ไว้แล้ว พอเรา push โค้ด ทาง Github มันจะไปบอก Heroku, Heroku ก็ดูดโค้ดจาก Github เอาขึ้นไปบนโฮสต์ให้เราเลย ดีงาม

เหนือสิ่งอื่นใด Heroku ให้ใช้งานฟรีหากไม่มีการเข้าใช้งานโหดๆ อย่างเข้าทีเดียวพร้อมกันเป็นพันคน ซึ่งโค้ดทดลองของเราไม่มีทางเป็นอย่างนั้นแน่นอน และอีกอย่าง เราไม่ต้องป้อนบัตรเครดิตใดๆให้ทาง Heroku ทำให้อาการอยู่ๆแล้วมีเงินเรียกเก็บเข้ามานั้น เป็นไปไม่ได้

Heroku มันจะถามหาบัตรเครดิตก็ต่อเมื่อมันเกินลิมิตฟรีโน่นแหละ ซึ่งโค้ดของเราไม่มีทางเกินลิมิต นี่ยืนยันอีกครั้ง

แต่... ชีวิตต้องมีแต่

Heroku ให้เราใช้ฐานข้อมูล Postgresql เป็นหลัก ใช้ฟรี แต่ก็ไม่มีปัญหา ในหนังสือเล่มนี้ผมจะเขียนอธิบายการใช้งานฐานข้อมูล Postgresql ให้ง่ายที่สุด ใส่ข้อมูลได้ไม่เกิน 10,000 แถว เพียงพอต่อการทดสอบเขียนโค้ดของเรา จริงๆแล้ว ทาง Heroku มี mysql ให้ใช้ฟรีนะ แต่ก่อนจะติดตั้ง mysql ได้เขาบังคับให้ป้อนเลขบัตรเครดิต ซึ่งผมคิดว่าเราใช้ Postgresql กันดีกว่า

สำหรับคนที่ไม่มีแอคเค้า Github และไม่เคยใช้ Git มาก่อน ถึงคราวที่คุณจะต้องหาข้อมูลในส่วนนี้เพิ่มเติม ซึ่งผมจะไม่เขียนเรื่องเกี่ยวกับ Git ไว้ในหนังสือเล่มนี้

## Git คืออะไร

Git เป็น Source Control Management ตัวหนึ่งที่ได้รับความนิยมจนน่าจะพูดได้ว่ากลายไปเป็นสิ่งที่โปรแกรมเมอร์ทุกคนต้องใช้ แล้ว Source Control Management คืออะไร มันก็จะเหมือนกับเซฟพ้อยต์ของโค้ด  เราเขียนโค้ดทดสอบโค้ด ใช้งานได้ดี เราก็ push ขึ้นไปเก็บบน Git repository ซึ่งตัว Git เอามันจะเก็บความแตกต่างของโค้ดที่เราส่งไปเก็บครั้งก่อน กับที่เราส่งไปเก็บใหม่ไว้ นั่นทำให้เราสามารถย้อนกลับไปดูโค้ดเมื่อห้าวันก่อน หรือเมื่อปีก่อน หรือเมื่อที่เรา release ไปเมื่อปีที่แล้วได้อย่างไม่มีปัญหา  นั่นทำให้มองได้ว่า Git มันทำหน้าที่ backup โค้ดก็ว่าได้

ทีนี้ใครที่เชื่อมต่อเข้ามายัง Git repository เดียวกัน ทุกคนจะได้รับการแจ้งเตือนว่ามีโค้ดใหม่อัปเดตเข้ามา ให้ทำการ pull ดึงลงมาที่เครื่องตัวเอง นั่นทำให้มองได้ว่า เป็นการรวมกลุ่มกันพัฒนาโปรแกรม โดยมี Git เป็นตัวช่วยดูแลโค้ด

## Git repository คืออะไร

Git repository ให้คิดเสียว่ามันเหมือนโฟลเดอร์เก็บโปรเจ็กของเรา เก็บโค้ดของเรา อือ คิดให้ง่ายมันก็แค่นั้นแหละ

## Github คืออะไร

Github ก็คือเว็บที่ให้บริการที่เก็บ Git repository เป็นเสมือนตัวกลางที่เชื่อมโปรแกรมเมอร์เข้าด้วยกัน

## ภาพการทำงานของ LineBot API

![](/assets/msgapi-figure1.png)

ภาพมือถือทางซ้ายมือคือเราเป็นเพื่อนกับบอทแล้วและกำลังแชทกับบอท เมื่อเราพิมพ์ข้อความบางอย่างส่งให้บอท ข้อความนั้นจะถูกส่งจากโปรแกรมไลน์ เข้าไปยังเซิฟเวอร์ของไลน์ จากนั้นไลน์จะส่งต่อข้อความนั้นไปให้ระบบของเรา  พอไลน์ส่งข้อความให้ระบบของเรา จากนั้นเราจะเขียนโปรแกรมอะไรก็เรื่องของเราตรงนั้น หลังประมวลผล เราก็ส่งข้อความที่อยากจะให้บอทตอบ กลับไปให้ไลน์เซิฟเวอร์ ไลน์เซิฟเวอร์จะส่งต่อไปให้โปรแกรมไลน์เอง

หากใครสงสัยว่าแล้วไลน์มันจะรู้ได้ไงว่าข้อความส่งหาใคร  ไลน์มันจะสร้าง replyToken ขึ้นมาครับ ซึ่ง replyToken นี้จะเป็นตัวบอกเองว่าข้อความนั้นๆเป็นของใคร  เราไม่ต้องสนใจว่ามันสร้าง replyToken ยังไง เอาเป็นว่าไลน์มันรู้ของมันละกัน

